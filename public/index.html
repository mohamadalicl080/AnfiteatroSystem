<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anfiteatro Registro - Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * { font-family: 'Inter', sans-serif; }

        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }

        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-card-green { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card-orange { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .stat-card-purple { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }

        input[type="date"]::-webkit-calendar-picker-indicator { cursor: pointer; filter: invert(0.5); }

        .notification-badge { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .tab-active { border-bottom: 3px solid #667eea; color: #667eea; font-weight: 600; }
        .modal-overlay { backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Top Navigation Bar -->
    <nav class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-building text-2xl"></i>
                    <div>
                        <h1 class="text-xl font-bold">Anfiteatro Registro</h1>
                        <p class="text-xs text-purple-200">Sistema de Gesti√≥n Comercial</p>
                    </div>
                </div>

                <div class="flex items-center space-x-6">
                    <div class="relative">
                        <i class="fas fa-bell text-xl cursor-pointer"></i>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center notification-badge">3</span>
                    </div>

                    <div class="flex items-center space-x-2">
                        <img src="https://ui-avatars.com/api/?name=Admin&background=fff&color=667eea"
                             class="h-8 w-8 rounded-full" alt="User">
                        <div class="text-sm">
                            <p class="font-semibold">Admin</p>
                            <p class="text-xs text-purple-200">Administrador</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Stats Overview -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
            <div class="stat-card rounded-xl p-6 text-white card-hover cursor-pointer">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm opacity-90">Ingresos Mes</p>
                        <h3 class="text-3xl font-bold mt-2"><span id="cardIngresosMes">$0</span></h3>
                        <p class="text-xs mt-2 opacity-75">+12% vs mes anterior</p>
                    </div>
                    <i class="fas fa-arrow-trend-up text-3xl opacity-50"></i>
                </div>
            </div>

            <div class="stat-card-green rounded-xl p-6 text-white card-hover cursor-pointer">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm opacity-90">Egresos Mes</p>
                        <h3 class="text-3xl font-bold mt-2"><span id="cardEgresosMes">$0</span></h3>
                        <p class="text-xs mt-2 opacity-75">-5% vs mes anterior</p>
                    </div>
                    <i class="fas fa-arrow-trend-down text-3xl opacity-50"></i>
                </div>
            </div>

            <!-- Balance Total Hist√≥rico -->
            <div class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl p-6 text-white card-hover cursor-pointer shadow-lg">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm opacity-90">Balance Total</p>
                        <h3 class="text-3xl font-bold mt-2"><span id="cardBalanceTotal">$0</span></h3>

                        <p class="text-xs mt-2 opacity-75">
                            <i class="fas fa-arrow-up mr-1"></i><span id="cardIngresosTotal">$0</span> ingresos
                        </p>
                        <p class="text-xs opacity-75">
                            <i class="fas fa-arrow-down mr-1"></i><span id="cardEgresosTotal">$0</span> egresos
                        </p>
                    </div>
                    <i class="fas fa-chart-line text-3xl opacity-50"></i>
                </div>
            </div>

            <div class="stat-card-orange rounded-xl p-6 text-white card-hover cursor-pointer">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm opacity-90">Morosos</p>
                        <h3 class="text-3xl font-bold mt-2"><span id="cardMorosos">0</span></h3>
                        <p class="text-xs mt-2 opacity-75">3 con m√°s de 30 d√≠as</p>
                    </div>
                    <i class="fas fa-exclamation-triangle text-3xl opacity-50"></i>
                </div>
            </div>

            <div class="stat-card-purple rounded-xl p-6 text-gray-800 card-hover cursor-pointer">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm opacity-90">Caja Chica</p>
                        <h3 class="text-3xl font-bold mt-2"><span id="cardCajaChica">$0</span></h3>
                        <p class="text-xs mt-2 opacity-75">Saldo disponible</p>
                    </div>
                    <i class="fas fa-wallet text-3xl opacity-50"></i>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="bg-white rounded-t-xl shadow-sm border-b">
            <div class="flex space-x-8 px-6 overflow-x-auto">
                <button class="py-4 tab-active whitespace-nowrap" onclick="showTab('movimientos')">
                    <i class="fas fa-exchange-alt mr-2"></i>Movimientos
                </button>
                <button class="py-4 text-gray-600 hover:text-purple-600 whitespace-nowrap" onclick="showTab('gastos')">
                    <i class="fas fa-receipt mr-2"></i>Gastos Comunes
                </button>
                <button class="py-4 text-gray-600 hover:text-purple-600 whitespace-nowrap" onclick="showTab('arriendos')">
                    <i class="fas fa-home mr-2"></i>Arriendos
                </button>
                <button class="py-4 text-gray-600 hover:text-purple-600 whitespace-nowrap" onclick="showTab('proveedores')">
                    <i class="fas fa-tools mr-2"></i>Proveedores
                </button>
                <button class="py-4 text-gray-600 hover:text-purple-600 whitespace-nowrap" onclick="showTab('empleados')">
                    <i class="fas fa-users mr-2"></i>Empleados
                </button>
                <button class="py-4 text-gray-600 hover:text-purple-600 whitespace-nowrap" onclick="showTab('caja-chica')">
                    <i class="fas fa-wallet mr-2"></i>Caja Chica
                </button>
                <button class="py-4 text-gray-600 hover:text-purple-600 whitespace-nowrap" onclick="showTab('otros')">
                    <i class="fas fa-folder mr-2"></i>Otros
                </button>
                <button class="py-4 text-gray-600 hover:text-purple-600 whitespace-nowrap" onclick="showTab('alertas')">
                    <i class="fas fa-bell mr-2"></i>Alertas
                    <span class="ml-1 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">3</span>
                </button>
                <button class="py-4 text-gray-600 hover:text-purple-600 whitespace-nowrap" onclick="showTab('resumen')">
                    <i class="fas fa-chart-pie mr-2"></i>Resumen Mensual
                </button>
                <button class="py-4 text-gray-600 hover:text-purple-600 whitespace-nowrap" onclick="showTab('actividad')">
                    <i class="fas fa-history mr-2"></i>Registro Actividad
                    <span class="ml-1 bg-purple-500 text-white text-xs px-2 py-0.5 rounded-full">Admin</span>
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div id="movimientos-tab" class="bg-white rounded-b-xl shadow-lg p-6">

            <!-- Action Buttons -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-list-ul mr-2 text-purple-600"></i>Movimientos Recientes
                </h2>
                <div class="flex space-x-3">
                    <button onclick="openNewMovementModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2.5 rounded-lg font-semibold shadow-md transition duration-200 flex items-center">
                        <i class="fas fa-plus mr-2"></i>Nuevo Movimiento
                    </button>
                    <button id="exportButton" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2.5 rounded-lg font-semibold shadow-md transition duration-200 flex items-center">
                        <i class="fas fa-download mr-2"></i>Exportar
                        <span class="ml-2 text-xs bg-green-800 px-2 py-0.5 rounded-full">Admin</span>
                    </button>
                </div>
            </div>

            <!-- Filters -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">√Årea</label>
                    <select id="filterArea" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option>Todas las √°reas</option>
                        <option>Gastos Comunes</option>
                        <option>Arriendos</option>
                        <option>Proveedores</option>
                        <option>Empleados</option>
                        <option>Caja Chica</option>
                        <option>Otros</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                    <select id="filterTipo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option>Todos</option>
                        <option>Ingreso</option>
                        <option>Egreso</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Desde</label>
                    <input id="filterDesde" type="date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Hasta</label>
                    <input id="filterHasta" type="date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
            </div>

            <!-- Movements Table -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Fecha</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">√Årea</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Tipo</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Descripci√≥n</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Monto</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Responsable</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="movimientosBody" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>

            <!-- Pagination (demo) -->
            <div class="flex justify-between items-center mt-6">
                <p class="text-sm text-gray-600">Mostrando resultados filtrados (√∫ltimos 20)</p>
                <div class="flex space-x-2">
                    <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50">Anterior</button>
                    <button class="px-4 py-2 bg-purple-600 text-white rounded-lg">1</button>
                    <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50">2</button>
                    <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50">3</button>
                    <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50">Siguiente</button>
                </div>
            </div>
        </div>

    </div>

    <!-- TAB: Registro de Actividad (SOLO ADMIN) -->
    <div id="actividad-tab" class="hidden bg-white rounded-b-xl shadow-lg p-6">
        <!-- (tu contenido demo intacto) -->
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-history mr-2 text-purple-600"></i>Registro de Actividad de Usuarios
                </h2>
                <p class="text-sm text-gray-500 mt-1">Historial completo de acciones realizadas por los editores</p>
            </div>
            <div class="flex items-center space-x-3">
                <span class="bg-purple-100 text-purple-800 px-4 py-2 rounded-lg font-semibold text-sm">
                    <i class="fas fa-shield-alt mr-2"></i>Solo Administrador
                </span>
                <button class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg font-semibold shadow-md transition duration-200 flex items-center">
                    <i class="fas fa-download mr-2"></i>Exportar Log
                </button>
            </div>
        </div>

        <!-- Tabla demo... -->
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Fecha/Hora</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Usuario</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Acci√≥n</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Descripci√≥n</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">IP/Dispositivo</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Estado</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <!-- (tu demo rows) -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal: Nuevo Movimiento -->
    <div id="newMovementModal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-overlay flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="gradient-bg text-white p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-2xl font-bold">Nuevo Movimiento</h3>
                        <p class="text-sm text-purple-200 mt-1">Registra un nuevo movimiento financiero</p>
                    </div>
                    <button onclick="closeModal()" class="text-white hover:text-gray-200 text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <form class="p-6 space-y-4" id="movementForm">

                <!-- Fecha -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-calendar text-purple-600 mr-2"></i>Fecha del Movimiento
                    </label>
                    <input type="date"
                           value="2026-02-06"
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200"
                           required>
                </div>

                <!-- √Årea -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-layer-group text-purple-600 mr-2"></i>√Årea
                    </label>
                    <select class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200" required>
                        <option value="">Seleccione un √°rea...</option>
                        <option value="gastos-comunes">üí° Gastos Comunes</option>
                        <option value="arriendos">üè† Arriendos</option>
                        <option value="proveedores">üîß Proveedores</option>
                        <option value="empleados">üë• Empleados</option>
                        <option value="caja-chica">üí∞ Caja Chica</option>
                        <option value="otros">üìã Otros</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Los datos se distribuir√°n autom√°ticamente a la pesta√±a correspondiente</p>
                </div>

                <!-- Tipo de Movimiento -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-exchange-alt text-purple-600 mr-2"></i>Tipo de Movimiento
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <label class="relative">
                            <input type="radio" name="tipo" value="ingreso" class="peer sr-only" required>
                            <div class="border-2 border-gray-200 rounded-lg p-4 cursor-pointer peer-checked:border-green-500 peer-checked:bg-green-50 transition duration-200">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-arrow-up text-2xl text-green-600"></i>
                                    <div>
                                        <p class="font-semibold text-gray-800">Ingreso</p>
                                        <p class="text-xs text-gray-500">Entrada de dinero</p>
                                    </div>
                                </div>
                            </div>
                        </label>
                        <label class="relative">
                            <input type="radio" name="tipo" value="egreso" class="peer sr-only" required>
                            <div class="border-2 border-gray-200 rounded-lg p-4 cursor-pointer peer-checked:border-red-500 peer-checked:bg-red-50 transition duration-200">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-arrow-down text-2xl text-red-600"></i>
                                    <div>
                                        <p class="font-semibold text-gray-800">Egreso</p>
                                        <p class="text-xs text-gray-500">Salida de dinero</p>
                                    </div>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Monto -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-dollar-sign text-purple-600 mr-2"></i>Monto
                    </label>
                    <div class="relative">
                        <span class="absolute left-4 top-3.5 text-gray-500 font-semibold">$</span>
                        <input type="number"
                               placeholder="0"
                               class="w-full pl-8 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200"
                               required>
                    </div>
                </div>

                <!-- Descripci√≥n -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-align-left text-purple-600 mr-2"></i>Descripci√≥n
                    </label>
                    <textarea
                        rows="3"
                        placeholder="Ej: Pago arriendo Local 12 - Febrero 2026"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200"
                        required></textarea>
                </div>

                <!-- (resto de tu modal intacto) -->
                <div class="bg-gray-50 border-2 border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-700 mb-4 flex items-center">
                        <i class="fas fa-info-circle text-purple-600 mr-2"></i>
                        Detalles Adicionales
                    </h4>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üè™ N√∫mero de Local</label>
                            <select class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">Seleccionar local...</option>
                                <option value="local-01">Local 01</option>
                                <option value="local-02">Local 02</option>
                                <option value="local-03">Local 03</option>
                                <option value="local-04">Local 04</option>
                                <option value="local-05">Local 05</option>
                                <option value="local-06">Local 06</option>
                                <option value="local-07">Local 07</option>
                                <option value="local-08">Local 08</option>
                                <option value="local-09">Local 09</option>
                                <option value="local-10">Local 10</option>
                                <option value="local-11">Local 11</option>
                                <option value="local-12">Local 12</option>
                                <option value="oficina">Oficina Administrativa</option>
                                <option value="area-comun">√Årea Com√∫n</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üë§ Arrendatario/Propietario</label>
                            <input type="text" placeholder="Ej: Juan P√©rez"
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üë∑ Nombre Empleado</label>
                            <select class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">No aplica / Seleccionar...</option>
                                <option value="emp-001">Juan P√©rez - Seguridad</option>
                                <option value="emp-002">Mar√≠a Gonz√°lez - Limpieza</option>
                                <option value="emp-003">Carlos Rojas - Mantenci√≥n</option>
                                <option value="emp-004">Ana Silva - Recepci√≥n</option>
                                <option value="emp-005">Pedro Mu√±oz - Jardiner√≠a</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üè¢ Proveedor/Empresa</label>
                            <input type="text" placeholder="Ej: Empresa de Limpieza S.A."
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üÜî RUT/Identificaci√≥n</label>
                            <input type="text" placeholder="Ej: 12.345.678-9"
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üí≥ M√©todo de Pago</label>
                            <select class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">Seleccionar m√©todo...</option>
                                <option value="efectivo">üíµ Efectivo</option>
                                <option value="transferencia">üè¶ Transferencia</option>
                                <option value="cheque">üìÑ Cheque</option>
                                <option value="tarjeta">üí≥ Tarjeta</option>
                                <option value="debito-automatico">üîÑ D√©bito Autom√°tico</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üßæ N¬∞ Comprobante/Boleta</label>
                            <input type="text" placeholder="Ej: 00123456"
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‚è∞ Fecha Vencimiento</label>
                            <input type="date"
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‚úÖ Estado de Pago</label>
                            <select class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="pagado">‚úÖ Pagado</option>
                                <option value="pendiente">‚è≥ Pendiente</option>
                                <option value="atrasado">‚ö†Ô∏è Atrasado</option>
                                <option value="parcial">üìä Pago Parcial</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üè∑Ô∏è Concepto/Categor√≠a</label>
                            <select class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">Sin especificar</option>
                                <option value="luz">üí° Luz</option>
                                <option value="agua">üíß Agua</option>
                                <option value="seguridad">üõ°Ô∏è Seguridad</option>
                                <option value="limpieza">üßπ Limpieza</option>
                                <option value="mantenci√≥n">üîß Mantenci√≥n</option>
                                <option value="arriendo">üè† Arriendo</option>
                                <option value="sueldo">üí∞ Sueldo</option>
                                <option value="anticipo">üí∏ Anticipo</option>
                                <option value="multa">‚ö†Ô∏è Multa</option>
                                <option value="deposito">üè¶ Dep√≥sito Garant√≠a</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ Per√≠odo Correspondiente</label>
                            <input type="month"
                                   value="2026-02"
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                    </div>

                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">üìù Notas Adicionales</label>
                        <textarea rows="2" placeholder="Informaci√≥n adicional relevante..."
                                  class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                    </div>
                </div>

                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-user-check text-purple-600"></i>
                        <p class="text-sm text-gray-700">
                            <span class="font-semibold">Responsable:</span>
                            <span class="text-purple-600">Admin (asignado autom√°ticamente)</span>
                        </p>
                    </div>
                </div>

                <div class="flex space-x-3 pt-4">
                    <button type="button"
                            onclick="closeModal()"
                            class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition duration-200">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </button>
                    <button type="submit"
                            class="flex-1 px-6 py-3 gradient-bg text-white rounded-lg font-semibold hover:shadow-lg transition duration-200">
                        <i class="fas fa-save mr-2"></i>Guardar Movimiento
                    </button>
                </div>

            </form>
        </div>
    </div>

    <script>
        // Simular roles de usuario (en la app real viene de Google OAuth)
        const currentUser = {
            name: 'Admin',
            role: 'admin', // 'admin', 'editor_full', 'editor_limited'
            email: 'admin@anfiteatro.cl'
        };

        // Funci√≥n para mostrar/ocultar pesta√±as
        function showTab(tabName) {
            document.getElementById('movimientos-tab').classList.add('hidden');
            const actividadTab = document.getElementById('actividad-tab');
            if (actividadTab) actividadTab.classList.add('hidden');

            if (tabName === 'movimientos') {
                document.getElementById('movimientos-tab').classList.remove('hidden');
            } else if (tabName === 'actividad') {
                if (currentUser.role === 'admin') {
                    actividadTab.classList.remove('hidden');
                } else {
                    alert('‚õî Solo el Administrador puede acceder al Registro de Actividad');
                }
            } else {
                console.log('Mostrando pesta√±a:', tabName);
                alert(`Vista de "${tabName}" - Disponible en la versi√≥n completa`);
            }

            // Mantengo tu l√≥gica original (usa event global del browser)
            document.querySelectorAll('.py-4').forEach(tab => {
                tab.classList.remove('tab-active');
                tab.classList.add('text-gray-600');
            });
            event.target.closest('button').classList.add('tab-active');
            event.target.closest('button').classList.remove('text-gray-600');
        }

        function openNewMovementModal() {
            document.getElementById('newMovementModal').classList.remove('hidden');
        }
        function closeModal() {
            document.getElementById('newMovementModal').classList.add('hidden');
        }

        // ---------------------------
        // API helper
        // ---------------------------
        async function apiFetch(path, options = {}) {
            const res = await fetch(path, {
                ...options,
                headers: {
                    "Content-Type": "application/json",
                    ...(options.headers || {})
                }
            });
            const data = await res.json().catch(() => ({}));
            if (!res.ok || data.ok === false) throw new Error(data.error || `HTTP ${res.status}`);
            return data;
        }

        // ---------------------------
        // Helpers
        // ---------------------------
        function formatCLP(value) {
            const n = Number(value) || 0;
            return n.toLocaleString("es-CL", { style: "currency", currency: "CLP" });
        }

        function formatFechaISO(iso) {
            if (!iso || typeof iso !== "string") return "";
            const m = iso.match(/^(\d{4})-(\d{2})-(\d{2})/);
            if (!m) return iso;
            return `${m[3]}/${m[2]}/${m[1]}`;
        }

        function norm(s) {
            return (s ?? "")
                .toString()
                .trim()
                .toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "");
        }

        function findCol(header, candidates) {
            const h = header.map(norm);
            for (const c of candidates) {
                const i = h.indexOf(norm(c));
                if (i >= 0) return i;
            }
            return -1;
        }

        function parseMoney(v) {
            if (v == null) return 0;
            const s = v.toString().trim();
            const cleaned = s.replace(/[^\d-]/g, "");
            const n = Number(cleaned);
            return Number.isFinite(n) ? n : 0;
        }

        function setText(id, value) {
            const el = document.getElementById(id);
            if (el) el.textContent = value;
        }

        function monthOfFechaISO(fecha) {
            const m = (fecha || "").toString().match(/^(\d{4})-(\d{2})-(\d{2})/);
            return m ? `${m[1]}-${m[2]}` : "";
        }

        function calcStatsFromMovs(header, rows) {
            const iMonto = findCol(header, ["MontoAsignado", "Monto Asignado", "Monto"]);
            const iTipo  = findCol(header, ["Tipo"]);
            const iFecha = findCol(header, ["Fecha"]);
            const iEstadoPago = findCol(header, ["EstadoPago", "Estado Pago"]);
            const iArea  = findCol(header, ["√Årea", "Area"]);

            const now = new Date();
            const thisMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, "0")}`;

            let ingresosMes = 0;
            let egresosMes = 0;

            let ingresosTotal = 0;
            let egresosTotal = 0;

            let morosos = 0;
            let cajaChica = 0;

            for (const r of rows) {
                const fecha = iFecha >= 0 ? (r[iFecha] || "") : "";
                const tipo  = iTipo  >= 0 ? (r[iTipo]  || "") : "";
                const area  = iArea  >= 0 ? (r[iArea]  || "") : "";

                const tipoN = norm(tipo);
                const areaN = norm(area);

                const estadoPago = iEstadoPago >= 0 ? (r[iEstadoPago] || "") : "";

                const montoRaw = iMonto >= 0 ? r[iMonto] : 0;
                const monto = parseMoney(montoRaw);

                const isIngreso = (tipoN === "ingreso") || (tipoN === "" && monto > 0);
                const isEgreso  = (tipoN === "egreso")  || (tipoN === "" && monto < 0);

                if (isIngreso) ingresosTotal += Math.abs(monto);
                if (isEgreso)  egresosTotal  += Math.abs(monto);

                if (monthOfFechaISO(fecha) === thisMonth) {
                    if (isIngreso) ingresosMes += Math.abs(monto);
                    if (isEgreso)  egresosMes  += Math.abs(monto);
                }

                if (estadoPago) {
                    const e = estadoPago.toString().toLowerCase();
                    if (e.includes("atras") || e.includes("moro") || e.includes("pend")) morosos++;
                }

                const isCajaChica = areaN === "caja chica" || areaN === "caja-chica" || areaN === "cajachica";
                if (isCajaChica) {
                    if (isIngreso) cajaChica += Math.abs(monto);
                    if (isEgreso)  cajaChica -= Math.abs(monto);
                }
            }

            return {
                ingresosMes,
                egresosMes,
                ingresosTotal,
                egresosTotal,
                balanceTotal: ingresosTotal - egresosTotal,
                morosos,
                cajaChica
            };
        }

        function updateCards(header, rows) {
            const s = calcStatsFromMovs(header, rows);

            setText("cardIngresosMes", formatCLP(s.ingresosMes));
            setText("cardEgresosMes", formatCLP(s.egresosMes));

            setText("cardIngresosTotal", formatCLP(s.ingresosTotal));
            setText("cardEgresosTotal", formatCLP(s.egresosTotal));

            setText("cardBalanceTotal", formatCLP(s.balanceTotal));
            setText("cardMorosos", String(s.morosos));
            setText("cardCajaChica", formatCLP(s.cajaChica));
        }

        // ---------------------------
        // Cache global + render
        // ---------------------------
        const MOV = {
            header: [],
            rows: [],
            idx: null
        };

        function buildIdx(header) {
            return {
                id: findCol(header, ["ID"]),
                fecha: findCol(header, ["Fecha"]),
                area: findCol(header, ["√Årea", "Area"]),
                tipo: findCol(header, ["Tipo"]),
                descripcion: findCol(header, ["Descripci√≥n", "Descripcion"]),
                monto: findCol(header, ["Monto", "MontoAsignado", "Monto Asignado"]),
                responsable: findCol(header, ["Responsable"]),
            };
        }

        function getFilters() {
            const area = document.getElementById("filterArea")?.value || "Todas las √°reas";
            const tipo = document.getElementById("filterTipo")?.value || "Todos";
            const desde = document.getElementById("filterDesde")?.value || "";
            const hasta = document.getElementById("filterHasta")?.value || "";
            return { area, tipo, desde, hasta };
        }

        function inDateRange(fechaISO, desdeISO, hastaISO) {
            // fechaISO / desdeISO / hastaISO en formato yyyy-mm-dd
            if (!fechaISO) return true;
            if (desdeISO && fechaISO < desdeISO) return false;
            if (hastaISO && fechaISO > hastaISO) return false;
            return true;
        }

        function applyFiltersAndRender() {
            if (!MOV.rows?.length) {
                renderMovimientos([]);
                return;
            }

            const { area, tipo, desde, hasta } = getFilters();
            const idx = MOV.idx || buildIdx(MOV.header);

            const filtered = MOV.rows.filter(r => {
                const rArea = idx.area >= 0 ? (r[idx.area] || "") : "";
                const rTipo = idx.tipo >= 0 ? (r[idx.tipo] || "") : "";
                const rFecha = idx.fecha >= 0 ? (r[idx.fecha] || "") : "";

                // √Årea
                if (area && area !== "Todas las √°reas") {
                    if (norm(rArea) !== norm(area)) return false;
                }

                // Tipo
                if (tipo && tipo !== "Todos") {
                    if (norm(rTipo) !== norm(tipo)) return false;
                }

                // Rango fechas
                if (!inDateRange(rFecha, desde, hasta)) return false;

                return true;
            });

            renderMovimientos(filtered);
        }

        function renderMovimientos(rowsToRender) {
            const tbody = document.getElementById("movimientosBody");
            if (!tbody) return;

            const idx = MOV.idx || buildIdx(MOV.header);
            tbody.innerHTML = "";

            const lastRows = (rowsToRender || []).slice().reverse().slice(0, 20);

            lastRows.forEach(r => {
                const id = idx.id >= 0 ? r[idx.id] : "";
                const fecha = idx.fecha >= 0 ? r[idx.fecha] : "";
                const area = idx.area >= 0 ? r[idx.area] : "";
                const descripcion = idx.descripcion >= 0 ? r[idx.descripcion] : "";
                const responsable = idx.responsable >= 0 ? r[idx.responsable] : "";

                const montoVal = idx.monto >= 0 ? parseMoney(r[idx.monto]) : 0;

                // Tipo: preferir columna Tipo; si viene vac√≠o, inferir por signo
                let tipo = idx.tipo >= 0 ? (r[idx.tipo] || "") : "";
                tipo = norm(tipo) === "ingreso" ? "Ingreso" : norm(tipo) === "egreso" ? "Egreso" : (montoVal < 0 ? "Egreso" : "Ingreso");

                const montoAbs = Math.abs(montoVal);

                const tipoBadge =
                    tipo === "Ingreso"
                        ? `<span class="px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"><i class="fas fa-arrow-up mr-1"></i>Ingreso</span>`
                        : `<span class="px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800"><i class="fas fa-arrow-down mr-1"></i>Egreso</span>`;

                const tr = document.createElement("tr");
                tr.className = "hover:bg-gray-50 transition duration-150";

                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatFechaISO(fecha)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">${area || ""}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">${tipoBadge}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${descripcion || ""}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold ${tipo === "Ingreso" ? "text-green-600" : "text-red-600"}">
                        ${tipo === "Egreso" ? "-" : ""}${formatCLP(montoAbs).replace("-", "")}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                        <i class="fas fa-user-circle mr-1"></i>${responsable || ""}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button class="text-purple-600 hover:text-purple-900 mr-3" data-action="edit" data-id="${id}" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900" data-action="delete" data-id="${id}" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;

                tbody.appendChild(tr);
            });
        }

        // ---------------------------
        // Delete (best-effort)
        // ---------------------------
        async function deleteMovementById(id) {
            if (!id) throw new Error("Movimiento sin ID (no se puede eliminar).");

            // Intento 1: query param
            try {
                return await apiFetch(`/.netlify/functions/movimientos?id=${encodeURIComponent(id)}`, { method: "DELETE" });
            } catch (e1) {
                // Intento 2: path param
                return await apiFetch(`/.netlify/functions/movimientos/${encodeURIComponent(id)}`, { method: "DELETE" });
            }
        }

        // ---------------------------
        // Load movimientos
        // ---------------------------
        async function loadMovimientos() {
            const data = await apiFetch("/.netlify/functions/movimientos");
            MOV.header = data.header || [];
            MOV.rows = data.rows || [];
            MOV.idx = buildIdx(MOV.header);

            console.log("HEADER =>", MOV.header);
            console.log("IDX =>", MOV.idx);

            // Cards SIEMPRE con TODO (no afectadas por filtros)
            updateCards(MOV.header, MOV.rows);

            // Render filtrado
            applyFiltersAndRender();
        }

        // ---------------------------
        // Save movimiento
        // ---------------------------
        async function saveMovement(event) {
            event.preventDefault();

            try {
                const modal = document.getElementById("newMovementModal");
                if (!modal) throw new Error("No encuentro el modal newMovementModal");

                const form = modal.querySelector("#movementForm") || modal.querySelector("form") || modal;

                const fecha = form.querySelector('input[type="date"]')?.value?.trim() || "";
                const areaRaw = form.querySelector('select[required]')?.value?.trim() || "";
                const tipoRaw = form.querySelector('input[name="tipo"]:checked')?.value?.trim() || "";
                const descripcion = form.querySelector('textarea[required]')?.value?.trim() || "";
                const monto = Number(form.querySelector('input[type="number"]')?.value || 0) || 0;
                const periodo = form.querySelector('input[type="month"]')?.value?.trim() || "";

                const AREA_MAP = {
                    "gastos-comunes": "Gastos Comunes",
                    "arriendos": "Arriendos",
                    "proveedores": "Proveedores",
                    "empleados": "Empleados",
                    "caja-chica": "Caja Chica",
                    "otros": "Otros"
                };
                const area = AREA_MAP[areaRaw] || areaRaw;

                const tipo = (tipoRaw === "ingreso" ? "Ingreso" : tipoRaw === "egreso" ? "Egreso" : tipoRaw);

                if (!fecha || !area || !tipo || !descripcion) {
                    throw new Error(`Faltan campos requeridos (fecha, area, tipo, descripcion).
fecha="${fecha}" area="${area}" tipo="${tipo}" descripcion="${descripcion}"`);
                }

                const payload = {
                    fecha,
                    area,
                    tipo,
                    descripcion,
                    monto,
                    responsable: currentUser?.name || "Admin",
                    periodo
                };

                console.log("PAYLOAD =>", payload);

                const result = await apiFetch("/.netlify/functions/movimientos", {
                    method: "POST",
                    body: JSON.stringify(payload)
                });

                const successAlert = document.createElement('div');
                successAlert.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg flex items-center z-50';
                successAlert.innerHTML = `
                    <i class="fas fa-check-circle text-2xl"></i>
                    <div class="ml-3">
                        <p class="font-semibold">Movimiento guardado!</p>
                        <p class="text-sm">ID: ${result.id}</p>
                        <p class="text-xs mt-1">Sincronizado con Google Sheets</p>
                    </div>
                `;
                document.body.appendChild(successAlert);

                modal.classList.add('hidden');
                setTimeout(() => successAlert.remove(), 4000);

                await loadMovimientos();

            } catch (err) {
                alert("‚ùå Error guardando: " + err.message);
                console.error(err);
            }
        }

        // ---------------------------
        // DOMContentLoaded (√öNICO)
        // ---------------------------
        document.addEventListener("DOMContentLoaded", () => {
            // submit modal
            const form = document.getElementById("movementForm");
            if (form) form.addEventListener("submit", saveMovement);

            // cargar movimientos
            loadMovimientos().catch(console.error);

            // filtros
            ["filterArea", "filterTipo", "filterDesde", "filterHasta"].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener("change", applyFiltersAndRender);
            });

            // click actions (edit/delete) por delegaci√≥n
            const tbody = document.getElementById("movimientosBody");
            if (tbody) {
                tbody.addEventListener("click", async (e) => {
                    const btn = e.target.closest("button[data-action]");
                    if (!btn) return;

                    const action = btn.getAttribute("data-action");
                    const id = btn.getAttribute("data-id");

                    if (action === "edit") {
                        alert(`‚úèÔ∏è Editar movimiento (demo)\nID: ${id}\n\nSi quieres, te implemento edici√≥n real contra el backend.`);
                    }

                    if (action === "delete") {
                        if (!id) return alert("No encontr√© el ID del movimiento.");
                        if (!confirm(`¬øEliminar movimiento ID ${id}?`)) return;

                        try {
                            await deleteMovementById(id);
                            alert("‚úÖ Eliminado");
                            await loadMovimientos();
                        } catch (err) {
                            alert("‚ùå No pude eliminar: " + err.message);
                            console.error(err);
                        }
                    }
                });
            }

            // export permisos
            const exportButton = document.getElementById("exportButton");
            if (exportButton) {
                if (currentUser.role !== "admin") {
                    exportButton.classList.add("opacity-50", "cursor-not-allowed");
                    exportButton.onclick = function (e) {
                        e.preventDefault();
                        alert("‚õî Solo el Administrador puede exportar datos del sistema");
                    };
                } else {
                    exportButton.onclick = function () {
                        alert("‚úÖ Exportando datos completos del sistema...\n\nFormatos disponibles:\n‚Ä¢ Excel (.xlsx)\n‚Ä¢ CSV\n‚Ä¢ PDF\n‚Ä¢ JSON");
                    };
                }
            }
        });

        // Cerrar modal al hacer click fuera
        document.getElementById('newMovementModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
    </script>

</body>
</html>
